---
- name: Provision CentOS VM for dev environment
  hosts: centos-stream-template-clone
  become: yes
  gather_facts: false
  vars:
    the_secret: !vault |
                $ANSIBLE_VAULT;1.1;AES256
                65396232323663613135373761323534393134363237323562636463383237346138663962353263
                3830373764333835303333393631613139346162623635660a353763373131393261326462646263
                61653764333537666131303539323137653664356335356333323430343065666431623639333735
                3162653237653166310a326231663161346231646265353837616638356335656437373863393634
                33646463373332666136343936303162396565303639646239376430656532313037343361356363
                6432613965313966333930366438303436623835383563343133
  tasks:
  - name: Add the user 'jboivie'
    ansible.builtin.user:
      name: jboivie
      comment: Jens B
      password: "{{ requested_password|password_hash('sha512') }}"
  - name: Create projects directory
    ansible.builtin.file:
      path: /home/jboivie/projects
      state: directory
      owner: jboivie
      mode: '0755'
  - name: Download and Install code-server
    ansible.builtin.shell:
      cmd: curl -fsSL https://code-server.dev/install.sh | sh
  - name: Enable code-server
    ansible.builtin.shell:
      cmd: systemctl enable --now code-server@jboivie
  - name: Install latest Git
    dnf:
      name: git
      state: latest
  - name: Clone this project from Git
    ansible.builtin.shell: git clone https://{{ the_secret }}@github.com/forenkla/ansible-demo.git
    args:
      chdir: /home/jboivie/projects
